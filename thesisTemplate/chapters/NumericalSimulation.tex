% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../Tesi.tex
% !TEX spellcheck = en-EN

%************************************************
\chapter{Numerical Simulation}
\label{cap:numericalsimulation}
%************************************************

\wrong{lot of work to do here}

We used $LIGGGHTS$ as the simulation toolbox.
\improvement{Add some more propaganda from Kloss}
We decided to utilize a single
contact law for all the simulations performed.
The time step was between $1.29 \%$ and $1.53 \%$ of the Rayleigh time, which
also depends on the particle density ($\rho_p$).
Furthermore, we locked the size distribution, which was obtained by experimental
sieving, see Table \ref{tab:09DEMFixedinputvalues}.

The $DEM$ parameters for the Young's modulus ($E$) and the Poisson's coefficient
($\nu$) were taken from the literature, see \cite{RefWorks:175} 
and \cite{RefWorks:176}; however we reduced the former to increase the time step
($\Delta t$), following the recommendations of Ai et al. \cite{RefWorks:131}.


\section{Angle of Repose}
\label{sec:aorsim}

In $AoR$ simulations we sought to replicate meticulously the experimental setup, 
considering both the plate and the liftable boundary, with the same domain size consideration as before
see Fig. \ref{fig:065aorsim}. 
The particles had the same properties as in the shear-cell simulation. 
The first phase was identical to that of the shear-cell simulation. 
After lifting the boundary, the particles formed a heap.
An image post-processing software was used to obtain the average slope.
\input{images/065aorsim}

\section{Shear Cell}
\label{sec:scsimulation}
%************************************************

$LIGGGHTS$, the simulation toolbox we used, meets all the requirements of
modelling the shear tester described in \ref{sec:jsct}. 
First, it is capable of importing triangulated meshes of the two rings and a top lid. 
Since the real setup had a wall thickness, contact forces acting on a mesh are summed and can be saved, 
and thus shear force calculation is available out of the box. 
Second, the code can move a mesh with constant 
velocity as required for the measurement. 
To determine the shear stresses, the bulk solid had to be stressed with 
user-defined normal stresses. 
Therefore, a stress-controlled wall (servo-wall in $LIGGGHTS$) was applied to the lid. \\
Although the geometry differs, the $SSC$ was designed to obtain the same values for the shear stresses as the 
Jenike shear cell tester ($JSCT$), but with improved automation and reliability,
see Schulze \cite{RefWorks:118}. 
For this reason, the simulation setup was
based on the $JSCT$.
As suggested by Aigner et al. \cite{RefWorks:139} and Benvenuti et al. \cite{RefWorks:173}, 
the diameter and the height of the rings operated in the simulations had to be sufficiently large to avoid relevant wall effects. 
However, a larger domain increases the number of particles and thus
simulation time.
For this reason, we considered the cylinder dimension ($dCylDp$), which is
proportional to the mean particle diameter, as an additional $DEM$
parameter to be investigated. \\
A simulation run comprised four phases. 
First, the shear cell was filled with the granulate material, and it was allowed
to settle.
Then, the top lid was lowered and the first normal stress applied to the bulk
solid.
As in the experiment, the servo-wall allows calculating the position of the lid
while the first particle is being touched. 
The distance between the lid and the bottom of the domain multiplied by the 
simulation area gave the total volume.
Since the software already provided the total mass, we were able to calculate:
%************************************************
\input{equations/rhob}
%************************************************
Next, the ring moved by a distance $l=0.1875 \cdot radius ~of ~the ~ring$, and
the required pre-shear force was measured.
Finally, the normal load was reduced to a fraction of the initial load, 
the ring was moved again by a distance $l$, and the shear force was recorded. 
Unlike in the original experiment, the bottom ring was moved to facilitate the numerical simulation. 
The velocity of the ring displacement, and consequently the total simulation time, 
was determined by a trade-off between minimizing the normal load oscillation and
optimizing computation time. 
The former requires (relatively) low velocity, and the latter requires high
speed.
We chose a constant velocity of $3*(mean ~ particle ~ radius)/seconds$, as the
best trade-off.\\
The normal stresses (pre-shear and shear phases) applied in each simulation were
the same as in the experiments.
%, see \ref{subsec:srsctexperiment}.
The corresponding $\tau_{psh}$ and $\tau_{sh}$ were calculated - as in the experiments - from the mean of the plateau.\\
These coefficients, $COR$, $\mu_s$, $\mu_r$,
$\rho_p$ and $dCylDp$ (the cylinder dimension, proportional to the mean
particle diameter), as indicated in Table \ref{tab:10DEMVariableinputvalues}, 
were constant in each simulation, but their combination differed between
simulations.
Further, $dCylDp$ was used to evaluate the wall effect, but only $~10\%$ of the
simulations had a $dCylDp$ larger than $20$.
%(additional information can be found in \ref{subsec:srsctsimulation}).
The normal stress $\sigma_n$ and its
percentage during the incipient flow condition $\tau_{\%}$
varied to replicate twelve shear-cell load conditions. 
% The complete description of the shear-cell simulations can be found in \ref{subsec:srsctsimulation}, 
% and the $AoR$ simulation is presented in \ref{subsec:aorsimulation}.
A Matlab script allowed us to extract from the simulation output the numerical
values representative of bulk behaviour (hereafter called \textit{bulk values}),
see Table \ref{tab:14bulkvalues},
for each $DEM$ simulation parameter combination.
\change{reorder}

, which consists of
 bulk density ($\rho_b$),
 coefficient of internal friction in the pre-shear phase ($\mu_{psh}$),
 coefficient of internal friction in the shear phase ($\mu_{sh}$),
 and angle of repose ($AoR$).
 
\wrong{put in table and acronym this bulk values names.}
 
The first bulk value ($\rho_b$) was provided directly. 
For correctly performed simulations, see \ref{subsec:srsctsimulation}, we
observed a stress path as in Fig. \ref{fig:021simexample}.
First, the $\sigma_n$ was kept constant while the coefficient of internal
friction ($\mu_{ie}$) initially increased and then reached a plateau.
The second bulk value ($\mu_{psh}$) was calculated as the average of the
$\mu_{ie}$ in this plateau.
The $\sigma_n$ was then automatically reduced, in our example to $80 \%$ of
its initial value.
Subsequently, a second plateau developed.
We obtained the third
value ($\mu_{sh}$) as the average of $\mu_{ie}$ in this second plateau.
The stress path accords with the experimental one, especially the plateaux.\\
In the $AoR$ tests the average of the repose angles provided us with the fourth
bulk value, allowing us to define the numerical bulk behaviour.

Fig. \ref{fig:007shearcellsim} \\
\input{images/007shearcellsim}

Fig. \ref{fig:021simexample} \\
\input{images/021simexample}

Numerical samples of the stress path
    for the Schulze ring shear cell tester.
	Time was normalized: $\tilde{t} = t/t_{change}$, where $t_{change}$ is the
	point in time at which the normal stress ($\sigma_n$) was modified during the
	tests.
	Until $\tilde{t}=1$, the $\sigma_n$ was kept constant at 10,000 Pa.
	In Fig. \ref{fig:20experimental},
 	a plateau was reached at $\tilde{t}~=0.91$.
	The coefficient of pre-shear ($\mu_{psh}$) was calculated as the average of the
	coefficient of internal friction ($\mu_{ie}$) in this first plateau.
	At $\tilde{t}=1$, the $\sigma_n$ was reduced to $80 \%$ of its initial
	value, and soon after
	a second plateau developed.
	We obtained the coefficient of
	shear ($ \mu_{sh}$) as the average of $\mu_{ie}$ in this second plateau.
	The stress paths agree well, especially the plateaux.
	They were clearly relevant because
	the values representative of the bulk behaviours
	were collected there.